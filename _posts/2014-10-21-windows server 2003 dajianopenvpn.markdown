---
layout: post
title:  "windows server 2003 搭建openvpn"
date:   2014/10/21 11:05:58
categories: "windows 2003系列" openvpn
---
<p>服务器端 <p>安装openvpn <p>在这里<a href="http://swupdate.openvpn.org/community/releases/openvpn-install-2.3.4-I004-i686.exe">http://swupdate.openvpn.org/community/releases/openvpn-install-2.3.4-I004-i686.exe</a>下载openvpn <p>在服务器安装时记得勾选红框中的两个选项 <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image002_2.jpg"><img title="clip_image002" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image002" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image002_thumb.jpg" width="244" height="181"></a> <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image004_2.jpg"><img title="clip_image004" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image004" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image004_thumb.jpg" width="244" height="187"></a> <p>安装完成后 <p>编辑C:\Program Files (x86)\OpenVPN\easy-rsa目录下的vars.bat.sample文件，修改如下内容 <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image006_2.jpg"><img title="clip_image006" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image006" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image006_thumb.jpg" width="244" height="175"></a> <p>然后切换到如下目录 <p>cd /D C:\Program Files (x86)\OpenVPN\easy-rsa <p>init-config <p>vars <p>clean-all&nbsp; <p>生成根证书: <p>build-ca&nbsp; <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image008_2.jpg"><img title="clip_image008" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image008" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image008_thumb.jpg" width="244" height="164"></a> <p>build-dh <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image010_2.jpg"><img title="clip_image010" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image010" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image010_thumb.jpg" width="244" height="113"></a> <p>生成服务端证书： <p>build-key-server server&nbsp;&nbsp; <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image012_2.png"><img title="clip_image012" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image012" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image012_thumb.png" width="204" height="244"></a> <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image014_2.jpg"><img title="clip_image014" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image014" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image014_thumb.jpg" width="244" height="38"></a> <p>生成客户端证书 <p>build-key client1&nbsp; <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image016_2.png"><img title="clip_image016" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image016" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image016_thumb.png" width="208" height="244"></a> <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image018_2.jpg"><img title="clip_image018" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image018" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image018_thumb.jpg" width="244" height="35"></a> <p>将生成的（C:\Program Files (x86)\OpenVPN\easy-rsa\keys 目录下） <p>ca.crt,dh1024.pem,server.crt,server.key <p>复制到C:\Program Files (x86)\OpenVPN\config下 <p>在C:\Program Files (x86)\OpenVPN\config创建server.ovpn文件 <p>编辑该文件写入一下内容 <p>mode server  <p>local 10.247.58.67&nbsp; #这里替换为服务器内网IP <p>port 1194  <p>proto udp  <p>dev tun  <p>ca ca.crt  <p>cert server.crt  <p>key server.key # This file should be kept secret  <p>dh dh1024.pem  <p>server 172.16.1.0 255.255.255.0  <p>ifconfig-pool-persist ipp.txt  <p>push "redirect-gateway def1"  <p>push "dhcp-option DNS 8.8.8.8"  <p>push "dhcp-option DNS 8.8.4.4"  <p>client-to-client  <p>keepalive 10 120  <p>comp-lzo  <p>comp-noadapt  <p>user nobody  <p>group nobody  <p>persist-key  <p>persist-tun  <p>status openvpn-status.log  <p>verb 3  <p>右击计算机，点击管理 <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image020_2.jpg"><img title="clip_image020" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image020" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image020_thumb.jpg" width="231" height="222"></a> <p>在服务中启动openvpn <p><a href="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image022_2.jpg"><img title="clip_image022" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image022" src="http://francisar.github.io/images/2014-10-20/Windows-Live-Writer_cebb2cf5fc37_144A3_clip_image022_thumb.jpg" width="244" height="172"></a> <p>服务端设置完毕 <p>客户端 <p>安装openvpn后 <p>将ca.crt，client1.crt，client1.key，dh1024.pem copy到config目录下 <p>在config目录下创建client.ovpn 编辑client.ovpn写入以下内容 <p>client <p>proto udp <p>dev tun <p>remote 182.254.216.227 1194&nbsp; #这里替换为您的服务器外网IP <p>ca ca.crt <p>cert client1.crt <p>key client1.key # This file should be kept secret <p>dh dh1024.pem <p>keepalive 10 120 <p>comp-lzo <p>comp-noadapt <p>user daemon <p>group daemon <p>persist-key <p>persist-tun <p>status openvpn-status.log <p>verb 3 <p>双击启动openvpn-gui <p>连接openvpn即可 